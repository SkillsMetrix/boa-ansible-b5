
from fastapi import APIRouter,HTTPException,status
from . import userschema
from random import randrange

router= APIRouter()

# dummy user data

usersData=[{'uname':'Sam','email':'sam@mail.com','city':'NY','id':101}]

# search common logic

def searchUser(id):
    for index,data in enumerate(usersData):
        if(data['id'] == id):
            return data

@router.get('/loadusers')
def welcomeUser():
    return {'message':usersData}

@router.post('/adduser')
def adduser(payload: userschema.Users):
    userdata= payload.model_dump()
    userdata['id']=randrange(0,1000)
    usersData.append(userdata)
    return {'message':userdata}

@router.get("/finduser/{id}")
def findUser(id:int):
    serachResult= searchUser(id)
    if serachResult== None:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND,detail='OOPS,.... user not found with matching ID')
    return{"result":serachResult}


